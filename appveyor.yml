# This is the one with Docker
image: Windows Server 2019

environment:
  GCLOUD_TOKEN:
    secure: 7Hm0JCn6ytebec8n7sX0DV1VbVq+sP3oEMcRUoIdg2xHJ6jqMSpd5kyBs6Ud/UVCalqDptCjaCmRBZLNLI0CZ4ZZLz0mhzm1gAVitkvWXJGBv7rOF7i7zpaguXq97v1YbU+Vy3NPIe189w/t3jn53Q5B3J+hVnOTbXR/0pKcghU+aSHF2sUpci4RRfAoaUhyqJy9wzqkbftrFZ2R2Los5hZE3xKleAlQt/NKFHHQB8/KfHx/KJ5Zx/KWrHgfQQUP8mHe/hd7GOEbt7CbZt4frWs17pmPXAYeobq2mylSppHFwv34DX4ykWlZIfItxE7sbpRrH2Ve0cRE2W1zt3637ZNgnsDy7iSHatS+esLn8lr8hKt/PrrLa64uJP/72zFjoyLL1Y3Lu2onGtXv+tYPIzrVVRURdIDxQPcwMGoE79UjppERb7kzxgPkgxII7zYsSc0u7B6O48YvIEccFrsFkdPpw2WjAHpVoqSiB/3OHHRfTvHNpRGMOFHqGrZdYWN15wGRW2FnPw82zAHFpQpVKvbFL1pBYy/5PIadf/NXxTzrZT0wMvejLqJi/u7Yek94Nb7894onjSAm68yrwYQqpTtyDj4HYNULbUPDVUuHOTQhHirs+hToIGzgKzR7N3sUuFMvhToYIK9iBhj4NKu32eNEzi6S1uZ+r8KRckAvyMD0x38iz26mEUKLn/v95kAU2N7T6V02aAgttdW8skIA4+bKpWVLQxOBqIwQjJfoVRIqaAesBOKAaxLFmXFZMefaOUnLIGaneNt+1fndVdX3M4aaMRa24i2wn/sxHM83/gZTbQP/kqHffZMBgABbluwWzTt7p16BOArF3TTdBJoIrEIm7rhSQuCtSLFnpY7j8p/N6vuTKMdMEt0RO3HAoZW25X50ikDeM3NUL5KiDHCwivFW2hRp+Y7IEPEQQwAM0lyo1QAsEBvOqoxfiX4UmGX6AQE2GhC83Tt2KUdHER2grMji/vhrNnF6oPCUUQMnnWOljnROJo8Jo4QVG9MNUe98e0o6Gswxzk5U3RxUcEKv9R/zbptTp4Gu72JjaL4DUsScxHwxx68vBUNFSyUu7gnZZhoKdHOzzKiBCll8Y7BdlNS/r3L6eVQ54N8bDw9M5aLfClFBXFGiVW8+Bgh0tRyjWOZ0kI0r1+LqVgkdG+7YqacrE14gr0nBqVVR7O4/VWl2XQ+W92a/yV0vWvZwzolCP5PF39bF4OfURLy7ZPSm9g2ltdSOI6IZJO6QEujwlca+KO045jwZdWYgyaUweuut643VcHMKjiduPBRDmCi1P8Gl0zdyALaD8PgC9cXYRFbsic+UhL/Yv7hYF1vrI84pbnn43WS/obkIlaMR8YQcidYt+5lpeWCVmn//7/AnSUHpggFwNluL5mee8PrTG7yOTGVUSCsJHGAD5ceBR9dAuYeYGcuNSKMYLf+84tT2q4yq7tnh+xE4LSx3IDxqeCLKlOCMRZisdkpnqbuPptfKbtbmASQkhpik2T/u0IH4DQdCPo1b+FLg0ioBuoaZt0XB4W8VMyMS9JVpnJxhuYhUpHx9s4TOUrkhvPhouFBKDkp/+Lu1xuQAkhmrd56szDP/RveBfG/P/uea8LVh2p1Uv94TKPKlNGGPIPwAFCc6p14E3WfPX9MluqyNvxfKgL/YezWSJ+K/YoeI5EQTjR+N08dhaEhGQoF+h/HUGmFUyGXlPeFIviLkEg1WAA65Ve/1GVTVfetLaDF9vyvt9os57wDJs23n5NypfYVO4izGcizqX892gcxfTNHaa3GBRlOWv8GbErGecYL34ea+1BuYinrbi9DsSgiELN/ovQ3igPPTMtRFtmM1rKltjBz4SSl92PkV7uE53hFKz0WOGlAmov7fgvl9cbFD7ssAV52MS2fjUHDdFMpTGhfXBQ5bYPTmoicwdsUVhCu/eeOTNGXP8upz2KWaTCKZZgU7zUbZKTMKt7Vbu0vEglV03+WnVeF4sctxe09fGfTp8wwPGHYG2dNP60ndHgDx4BaE1ZCzYK9eImtm+GhBs5uAUFnmxDMVM6k7MZee2di2EKDeuWWQ2TViE52+xjPZ7NUbVtMHGafBZxCUql6bHrNNzLHdXyyOgVqDjMQ+1d0C2yEBZXI27AJEu3fWf/zX4buRyOBk6HoJ64hFhLdMk+L2cxJF4C51UCrqj9jdxcH/DMLHgxRlQd8v/SI6SQLSqjwpJxtRRK9mx8Ee9xDpFpXeAqPzxQ1G35v1eL2vvTNp32eBu1FKZe5yztIrbNnc9UQyONgN4+m58FltjSa1QNlMckfywUUhYx5BnYTnWVL+2aiBowMyBAe6/MUxDsrei5j6y7OSpG8k5y0uxkfz06ksc8cgslWbYsgRvRlrtzEsTiV0WMHV+t89YwGvbJu9flwLypYqeXgoWHCBFmyhhyzGk8+2+YCfMYCrNNzVZijq6ajjh7sBNOYX/TaoHwT66H08aNK1VjbyHo2RcEDu16aqBeRqR0e4O3ZDrVlXVKZeEbMDTRikquiXfX4speunlUwdtHJJcmdAo/ta8PodIh9QOtAKpuP85ZuERSDVgdS+fKWPmJue6Cdw9RfwOoajDJCQi6CkLA+aKQVSV3E+qPrciBr6JWccpEk5JV3TOwKEQI7erg03kBuJuIJtppYjYfGaMJpzqYHaC+sLPT2PLqJE2TD2J9J3XF9L77jKxRaVjn77a726zFTxNcaHMR3FhTAHuTPmNPoZYxQ6wEqv2E5h/wr2rVJaRpZKO2Z80sfy1z8NV0abzYSE/eSE41f/r+fVmz1aA+507lkkqNO8MdPwAfR+yIHi446c7hLJX6OMXoc+4wvBC/NMbWK45IPJafZRWgtYnBuE5quBxjQPnufgq3lZYkw+P9pWNuEUW+ySpvl+O6AfpQAsuMAmhh51FJ+7TLX3KjZ+5kciyaSU5LCDYKfmFv2uBLoEVCvw3M+410GT4Y1mkuU3Sfk6FSebZgf1RLcw8UNK6P2g/WRoh9veIet3M2FLaYJvE85p0sJ0aKlBPidWLh1RbSW91UQ386fbVPYeFHkzi9Yco3ryEKzipDaB7fPAitN+VpLxwX7Uy2k3kPLrmdEZHPg8R9JR4G8iNX3tlrWTqYObya8jxuYWvQUQb/gX/PgmmjelG/YmmpgJrvjTo+BQ0E18YG1H3GMUDh8FMTufCeRa2jcjvoncMKlmoLpU+aOVl2qN9jD0BPAfJ5J6afAsf/FuToki47Rn5RhfA6nkbTdXzXD9pfRQKyKCjnLzEZAzxpYL0pNALwYkfS+ZLZOxmU7S0h9IJPLOKkvYzaKTjaoFhjUvh8KfxeUBQ76N7UXXmDg6B9WtSj37dMVOikUosgQyVRFR6lg+GVyRf4G1S0kZOcoeCxw1hgHCpbZc/tPBeJTD05XlQMFMSZ4YNR+DC2YufUQqxP+n8QT7Bu/oeQ3X25VRG7lCgpfgJvw8Y36HSfv0aVMd4N/xWeG19hdSsPErr5/DtPYEu1q9rSVOcNCWuyNyp/1q/VrYEAfFjwd+hpvhkYI1Xl0Q6IP8tSr1lXDw4X+V0XFjJVXMm6Ml7CuxyGl2+dt5rw1P/BfAhuhl09rz6zvM0PJlB/1YNsz9FjiDDRebRpTJ+grjhOvn92p5FJfBQnXbx9YJzPfOh1qz211MZbdb+VDepE+cap9qf3C4a5QapAvXV2tpYSZCKG0IqUHIB+xH80pOXBvDz7hb8fhaB0HXVwrN3j6AxfM7XNqtyWpvyI/lJihaj4uWnAHgAq3xco/BAt9fZMSd2EJalBG78ZHlJIU0th2wJ2EwXMDqBunKtJ+RQmoliw/gezKc2mI8ZXPEf6w/ewORw5g98yp5Hr91GE+Y0smUlJ7I1wDqe+DGJbYJgyH9/sWJDylGnIEIpQhw/B6rOkY92JvomLWGTHOln25JF7QYGW8A9RiC7CUjuxkDB7rRABlzVwMM80hgemrIbU4z+nzaUStqu0r1pF+vOagiePXx3VU6o3+A9lMmdjzY8vG86FvOVP6irEgK7rIeKB0w3nQh8qkE9bVfAW1/hVZJNMZcyXdJNcyfagAQtfMVIHVEYxySMi/S3o1ZtI1rYtZa/+FGXKeYct9dO1Ml+jNUP8ZgCqKTy8Xb+o+wXlo0ZYLhYvvLczjnAnWmK0VJvC1qJkTw

# # Install scripts. (runs after repo cloning)
# install:
#   # Get the latest stable version of Node.js or io.js
#   - ps: Install-Product node $env:nodejs_version
#   # install modules
#   - npm install -g yarn
#   - yarn install

# Post-install test scripts.
test_script:
  # - ps: Invoke-WebRequest -UserAgent 'AppVeyor CI' -outfile gcloud.zip https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-245.0.0-windows-x86_64-bundled-python.zip
  # - ps: Expand-Archive -path .\gcloud.zip -DestinationPath .
  # Borrowed from http://ec2-52-211-181-221.eu-west-1.compute.amazonaws.com/deploying-a-net-appengine-using-appveyor/
  - choco install gcloudsdk
  - refreshenv
  - gcloud.cmd components copy-bundled-python>>python_path.txt && SET /p CLOUDSDK_PYTHON=<python_path.txt && DEL python_path.txt
  - gcloud.cmd components update --quiet
  - ps: '[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($env:GCLOUD_TOKEN)) | Out-File token.json'
  - gcloud.cmd auth activate-service-account --key-file=token.json
  - gsutil.cmd cp README.md gs://build.livepeer.live/README.md
  - docker build -m 4gb -t livepeer-windows -f .\docker\Dockerfile.windows .
  - docker run --name wlive livepeer-windows
  - docker cp wlive:c:/temp/livepeer-windows-amd64.zip .
  - docker rm wlive
  - gsutil.cmd cp livepeer-windows-amd64.zip gs://build.livepeer.live/test/livepeer-windows-amd64.zip

# Don't actually build.
build: off
